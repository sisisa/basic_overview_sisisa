# N+1問題

- [N+1問題](#n1問題)
  - [参考ページ](#参考ページ)
  - [N+1問題とは](#n1問題とは)
  - [具体例](#具体例)
  - [問題点](#問題点)
  - [対策](#対策)
    - [SQLの例](#sqlの例)

## 参考ページ
https://qiita.com/1129-tame/items/5c8db29e4718b9f38959

## N+1問題とは
- DB周りの処理によって、パフォーマンスの低下(非効率な動作の発生)が起きてしまう問題

## 具体例
1. JavaScriptを検索して最初のURLを取得
https://developer.mozilla.org/ja/docs/Web/JavaScript

2. PHPを検索して最初のURLを取得
https://www.php.co.jp/

3. Pythonを検索して最初のURLを取得
https://www.python.org/

→「これで終わり！」と思ったら、実は2つ目以降のURLも必要だった。

→ もう一度検索し直さなければならず、手間も時間も増える。

## 問題点
1. 最初に「どの範囲の情報が欲しいか」を決めていない
2. 1件ずつループしてデータを取ると、データベースに負担がかかり処理が遅くなる

## 対策
- 最初に「何を、どこまで取得するか」をしっかり指定する
- まとめて必要な情報を取り出せるように処理を工夫する

→こうすることで、無駄な問い合わせが減り、処理が効率的になる

### SQLの例
```sql
SELECT u.name, p.title
FROM users u
JOIN posts p ON u.id = p.user_id;
```
**※こうすることで、必要な情報をまとめて1回のSQLで取得できる**